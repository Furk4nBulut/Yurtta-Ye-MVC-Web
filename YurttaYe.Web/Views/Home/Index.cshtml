@model YurttaYe.Core.Models.ViewModels.MenuViewModel
@{
ViewData["Title"] = "Menü Sorgula";
Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Header -->
<header class="bg-primary py-10 text-center">
    <div class="flex justify-center items-center space-x-2 mb-3">
        <i class="fas fa-utensils w-8 h-8 text-accent"></i>
        <h1 class="text-3xl font-bold text-primary">KYK Yemek Menüsü</h1>
    </div>
    <p class="text-primary text-lg">Şehir ve tarih seçerek yurt yemek listesini keşfedin</p>
</header>

<!-- Main Content Container -->
<div class="max-w-3xl mx-auto px-4 py-10">
    <!-- Form Card -->
    <div class="bg-card rounded-lg shadow-sm p-6 mb-8 border border-card">
        <form asp-action="Index" method="post" class="grid gap-6 sm:grid-cols-2" id="menuForm">
            <!-- Hidden Meal Type -->
            <input type="hidden" asp-for="MealType" id="MealType" value="@(Model.MealType ?? "Kahvaltı")" />

            <!-- City Selection -->
            <div>
                <label for="CityId" class="block text-lg font-medium text-primary mb-2">
                    <i class="fas fa-city mr-1 text-accent"></i> Şehir
                </label>
                <select asp-for="CityId" id="CityId" class="block w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-secondary focus:border-accent focus:ring focus:ring-teal-200 dark:focus:ring-teal-500 py-3 px-4 text-lg dark:text-white" asp-items="@Model.Cities">
                    <option value="">Şehir Seçin</option>
                </select>
                <span asp-validation-for="CityId" class="text-red-600 dark:text-red-400 text-sm mt-1 block"></span>
            </div>

            <!-- Date Picker -->
            <div>
                <label for="Date" class="block text-lg font-medium text-primary mb-2">
                    <i class="fas fa-calendar-alt mr-1 text-accent"></i> Tarih
                </label>
                <div class="relative">
                    <input type="text" asp-for="Date" id="Date" value="@Model.Date.ToString("yyyy-MM-dd")" class="flatpickr block w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-secondary focus:border-accent focus:ring focus:ring-teal-200 dark:focus:ring-teal-500 py-3 px-4 text-lg dark:text-white" readonly />
                    <span class="absolute right-4 top-3 text-gray-400 dark:text-gray-400">
                        <i class="fas fa-calendar-day h-5 w-5"></i>
                    </span>
                </div>
                <span asp-validation-for="Date" class="text-red-600 dark:text-red-400 text-sm mt-1 block"></span>
            </div>

            <!-- Meal Type Toggle -->
            <div class="sm:col-span-2 mt-4">
                <div class="flex space-x-4 justify-center">
                    <button type="button" id="breakfastBtn" class="flex-1 max-w-xs py-3 px-6 rounded-lg text-lg font-medium transition-colors @(Model.MealType == "Kahvaltı" ? "bg-accent text-white" : "bg-secondary text-primary hover:bg-accent hover:text-white")">
                        <i class="fas fa-coffee mr-1"></i> Kahvaltı
                    </button>
                    <button type="button" id="dinnerBtn" class="flex-1 max-w-xs py-3 px-6 rounded-lg text-lg font-medium transition-colors @(Model.MealType == "Akşam Yemeği" ? "bg-accent text-white" : "bg-secondary text-primary hover:bg-accent hover:text-white")">
                        <i class="fas fa-utensils mr-1"></i> Akşam Yemeği
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Error Message -->
    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
    <div class="bg-red-50 dark:bg-red-900/50 border-l-4 border-red-600 dark:border-red-500 text-red-800 dark:text-red-300 p-4 rounded-lg mb-8" id="errorAlert">
        <strong>Hata:</strong> @Model.ErrorMessage
        <button onclick="document.getElementById('errorAlert').remove()" class="float-right text-red-700 dark:text-red-200 hover:text-red-900 dark:hover:text-red-100">✕</button>
    </div>
    }

    <!-- Menu Display -->
    @if (Model.Menu != null)
    {
    string formattedDate = DateTime.TryParse(Model.Menu.Date, out var parsedDate)
    ? parsedDate.ToString("dd MMMM yyyy dddd", new System.Globalization.CultureInfo("tr-TR"))
    : string.Empty;

    <div class="bg-card rounded-lg shadow-sm p-6 mb-8 border border-card">
        <h2 class="text-2xl font-bold text-primary mb-4 flex items-center">
            <i class="fas fa-utensils mr-2 text-accent"></i> @(Model.MealType == "Kahvaltı" ? "Kahvaltı" : "Akşam Yemeği") - @formattedDate
        </h2>
        <p class="text-lg text-primary mb-4">@Model.Cities.FirstOrDefault(c => c.Value == Model.CityId.ToString())?.Text</p>
        <div class="space-y-6">
            @foreach (var category in Model.Menu.Items.Select(i => i.Category).Distinct())
            {
            <div>
                <h3 class="text-lg font-medium text-primary mb-3">@category</h3>
                <ul class="space-y-2">
                    @foreach (var item in Model.Menu.Items.Where(i => i.Category == category))
                    {
                    <li class="text-primary text-lg flex items-center">
                        <i class="fas fa-utensil-spoon mr-2 text-accent"></i>
                        <span>@item.Name</span>
                        @if (!string.IsNullOrWhiteSpace(item.Gram))
                        {
                        <span class="ml-2 text-sm text-gray-500 dark:text-gray-400">(@item.Gram)</span>
                        }
                    </li>
                    }
                </ul>
            </div>
            }
            <div class="text-lg font-medium text-primary border-t border-gray-300 dark:border-gray-600 pt-4">
                Toplam Enerji: <span class="text-accent ml-2"><i class="fas fa-bolt mr-1"></i> @Model.Menu.Energy</span>
            </div>
        </div>
    </div>
    }

    <!-- Mobile App Promotion Card -->
    <div class="bg-card rounded-lg shadow-sm p-6 border border-card">
        <div class="flex items-center space-x-2 mb-3">
            <i class="fas fa-mobile-alt w-6 h-6 text-accent"></i>
            <h2 class="text-xl font-semibold text-primary">YurttaYe Mobil Uygulaması</h2>
        </div>
        <p class="text-primary text-lg mb-4">
            Yurt yemek menüsünü her zaman, her yerde keşfedin! Mobil uygulamamızı indirerek menülere kolayca erişebilirsiniz.
        </p>
        <div class="flex flex-col sm:flex-row sm:space-x-4 space-y-3 sm:space-y-0">
            <a href="https://play.google.com/store/apps/details?id=com.yurttaye.yurttaye" target="_blank" class="flex-1 py-3 px-6 rounded-lg text-lg font-medium text-white bg-accent hover:bg-teal-600 transition-colors text-center" aria-label="Google Play'den YurttaYe uygulamasını indir">
                <i class="fab fa-google-play mr-1"></i> Google Play'den İndir
            </a>
            <a href="https://play.google.com/apps/testing/com.yurttaye.yurttaye" target="_blank" class="flex-1 py-3 px-6 rounded-lg text-lg font-medium text-primary bg-secondary hover:bg-accent hover:text-white transition-colors text-center" aria-label="YurttaYe test sürümünü deneyin">
                <i class="fas fa-vial mr-1"></i> Test Sürümünü Deneyin
            </a>
        </div>
        <p class="text-red-600 dark:text-red-400 text-sm mt-3">
            Uyarı: Test sürümü deneysel özellikler içerebilir ve kararsız olabilir.
        </p>
    </div>
</div>

@section Scripts {
<partial name="_ValidationScriptsPartial" />
<!-- Flatpickr -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    flatpickr("#Date", {
        dateFormat: "Y-m-d",
        maxDate: "today",
        locale: "tr"
    });

    document.getElementById("breakfastBtn").addEventListener("click", function () {
        document.getElementById("MealType").value = "Kahvaltı";
        document.getElementById("menuForm").submit();
    });

    document.getElementById("dinnerBtn").addEventListener("click", function () {
        document.getElementById("MealType").value = "Akşam Yemeği";
        document.getElementById("menuForm").submit();
    });
</script>
}
