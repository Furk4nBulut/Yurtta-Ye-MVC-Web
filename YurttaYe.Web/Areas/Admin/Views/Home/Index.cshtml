@model YurttaYe.Core.Models.ViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
    ViewData["Subtitle"] = "Yönetim Paneli";
}

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Total Menus Card -->
    <div class="admin-card bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white shadow-lg">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-blue-100 text-sm font-medium">Toplam Menü</p>
                <p class="text-3xl font-bold">@Model.TotalMenus</p>
                <div class="flex items-center mt-2">
                    <i class="fas fa-arrow-up text-green-300 mr-1"></i>
                    <span class="text-sm text-blue-100">Bu ay aktif</span>
                </div>
            </div>
            <div class="bg-white bg-opacity-20 rounded-full p-3">
                <i class="fas fa-utensils text-2xl"></i>
            </div>
        </div>
        <div class="mt-4">
            <a asp-area="Admin" asp-controller="AdminMenu" asp-action="Index" 
               class="text-blue-100 hover:text-white text-sm font-medium flex items-center">
                Menüleri Görüntüle
                <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>
    </div>

    <!-- Total Cities Card -->
    <div class="admin-card bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white shadow-lg">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-green-100 text-sm font-medium">Toplam Şehir</p>
                <p class="text-3xl font-bold">@Model.TotalCities</p>
                <div class="flex items-center mt-2">
                    <i class="fas fa-map-marker-alt text-green-300 mr-1"></i>
                    <span class="text-sm text-green-100">Kayıtlı şehir</span>
                </div>
            </div>
            <div class="bg-white bg-opacity-20 rounded-full p-3">
                <i class="fas fa-city text-2xl"></i>
            </div>
        </div>
        <div class="mt-4">
            <a asp-area="Admin" asp-controller="AdminCity" asp-action="Index" 
               class="text-green-100 hover:text-white text-sm font-medium flex items-center">
                Şehirleri Görüntüle
                <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>
    </div>

    <!-- Active Menus Card -->
    <div class="admin-card bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white shadow-lg">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-purple-100 text-sm font-medium">Son Menüler</p>
                <p class="text-3xl font-bold">@(Model.RecentMenus?.Count() ?? 0)</p>
                <div class="flex items-center mt-2">
                    <i class="fas fa-clock text-purple-300 mr-1"></i>
                    <span class="text-sm text-purple-100">Son eklenen</span>
                </div>
            </div>
            <div class="bg-white bg-opacity-20 rounded-full p-3">
                <i class="fas fa-list text-2xl"></i>
            </div>
        </div>
        <div class="mt-4">
            <button onclick="refreshRecentMenus()" 
                    class="text-purple-100 hover:text-white text-sm font-medium flex items-center">
                Yenile
                <i class="fas fa-sync-alt ml-2"></i>
            </button>
        </div>
    </div>

    <!-- System Status Card -->
    <div class="admin-card bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-white shadow-lg">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-orange-100 text-sm font-medium">Sistem Durumu</p>
                <p class="text-3xl font-bold">
                    <span id="system-status">100</span>%
                </p>
                <div class="flex items-center mt-2">
                    <i class="fas fa-circle text-green-300 mr-1 text-xs animate-pulse"></i>
                    <span class="text-sm text-orange-100">Çevrimiçi</span>
                </div>
            </div>
            <div class="bg-white bg-opacity-20 rounded-full p-3">
                <i class="fas fa-server text-2xl"></i>
            </div>
        </div>
        <div class="mt-4">
            <button onclick="checkSystemStatus()" 
                    class="text-orange-100 hover:text-white text-sm font-medium flex items-center">
                Durumu Kontrol Et
                <i class="fas fa-check-circle ml-2"></i>
            </button>
        </div>
    </div>
</div>

<!-- Quick Actions & Chart Section -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <!-- Quick Actions Card -->
    <div class="admin-card bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <i class="fas fa-bolt text-blue-500 mr-2"></i>
            Hızlı İşlemler
        </h3>
        <div class="space-y-3">
            <a asp-area="Admin" asp-controller="AdminMenu" asp-action="Create" 
               class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 transition-all group nav-link">
                <i class="fas fa-plus text-blue-500 mr-3 group-hover:scale-110 transition-transform"></i>
                <span class="font-medium text-gray-700 group-hover:text-blue-700">Yeni Menü Ekle</span>
            </a>
            <a asp-area="Admin" asp-controller="AdminCity" asp-action="Create" 
               class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-green-50 hover:border-green-300 transition-all group nav-link">
                <i class="fas fa-map-marker-alt text-green-500 mr-3 group-hover:scale-110 transition-transform"></i>
                <span class="font-medium text-gray-700 group-hover:text-green-700">Yeni Şehir Ekle</span>
            </a>
            <button onclick="exportData()" 
                    class="w-full flex items-center p-3 rounded-lg border border-gray-200 hover:bg-purple-50 hover:border-purple-300 transition-all group nav-link">
                <i class="fas fa-download text-purple-500 mr-3 group-hover:scale-110 transition-transform"></i>
                <span class="font-medium text-gray-700 group-hover:text-purple-700">Veri Dışa Aktar</span>
            </button>
        </div>
    </div>

    <!-- Chart Card -->
    <div class="lg:col-span-2 admin-card bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                <i class="fas fa-chart-line text-blue-500 mr-2"></i>
                Aylık Menü Dağılımı
            </h3>
            <div class="flex items-center space-x-2">
                <button onclick="updateChart('6months')" class="px-3 py-1 text-xs bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200">
                    6 Ay
                </button>
                <button onclick="updateChart('1year')" class="px-3 py-1 text-xs bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200">
                    1 Yıl
                </button>
            </div>
        </div>
        <div class="h-64 relative">
            <canvas id="menuChart" width="400" height="200"></canvas>
            <div id="chart-loading" class="absolute inset-0 flex items-center justify-center hidden">
                <i class="fas fa-spinner loading-spinner text-2xl text-gray-400"></i>
            </div>
        </div>
    </div>
</div>

<!-- Recent Menus Table -->
<div class="admin-card bg-white rounded-xl shadow-sm border border-gray-200">
    <div class="p-6 border-b border-gray-200">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                <i class="fas fa-clock text-blue-500 mr-2"></i>
                Son Eklenen Menüler
            </h3>
            <div class="flex items-center space-x-2">
                <button onclick="refreshTable()" 
                        class="text-gray-400 hover:text-gray-600 p-2 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <a asp-area="Admin" asp-controller="AdminMenu" asp-action="Index" 
                   class="text-blue-600 hover:text-blue-800 font-medium text-sm flex items-center">
                    Tümünü Gör
                    <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
        </div>
    </div>
    
    <div class="overflow-x-auto" id="recent-menus-table">
        @if (Model.RecentMenus != null && Model.RecentMenus.Any())
        {
            <table class="w-full">
                <thead class="bg-gray-50 border-b border-gray-200">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Şehir</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Öğün Türü</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tarih</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Durum</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">İşlemler</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    @foreach (var menu in Model.RecentMenus.Take(5))
                    {
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <i class="fas fa-map-marker-alt text-gray-400 mr-2"></i>
                                    <span class="text-sm font-medium text-gray-900">@menu.CityName</span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full 
                                      @(menu.MealType == "Sabah" ? "bg-yellow-100 text-yellow-800" : 
                                        menu.MealType == "Akşam" ? "bg-blue-100 text-blue-800" : "bg-gray-100 text-gray-800")">
                                    @menu.MealType
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                @menu.Date.ToString("dd.MM.yyyy")
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                    <i class="fas fa-check mr-1"></i>
                                    Aktif
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                <a asp-area="Admin" asp-controller="AdminMenu" asp-action="Edit" asp-route-id="@menu.Id" 
                                   class="nav-link inline-flex items-center px-3 py-1 rounded-md text-blue-600 hover:bg-blue-50 transition-colors">
                                    <i class="fas fa-edit mr-1"></i>
                                    Düzenle
                                </a>
                                <a asp-area="Admin" asp-controller="AdminMenu" asp-action="Details" asp-route-id="@menu.Id" 
                                   class="nav-link inline-flex items-center px-3 py-1 rounded-md text-gray-600 hover:bg-gray-50 transition-colors">
                                    <i class="fas fa-eye mr-1"></i>
                                    Görüntüle
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="p-8 text-center text-gray-500">
                <i class="fas fa-inbox text-4xl text-gray-300 mb-4"></i>
                <p class="text-lg font-medium">Henüz menü eklenmemiş</p>
                <p class="text-sm text-gray-400 mt-2">İlk menüyü ekleyerek başlayın</p>
                <a asp-area="Admin" asp-controller="AdminMenu" asp-action="Create" 
                   class="inline-flex items-center mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-plus mr-2"></i>
                    İlk Menüyü Ekle
                </a>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        let menuChart;
        
        // Initialize Chart
        function initializeChart() {
            const ctx = document.getElementById('menuChart').getContext('2d');
            menuChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran'],
                    datasets: [{
                        label: 'Eklenen Menüler',
                        data: [@(Model.TotalMenus), 19, 15, 25, 22, 30],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Dashboard Functions
        function refreshRecentMenus() {
            showAdminNotification('Menüler yenileniyor...', 'info');
            setTimeout(() => {
                showAdminNotification('Menüler başarıyla yenilendi!', 'success');
                location.reload();
            }, 1000);
        }

        function checkSystemStatus() {
            const statusElement = document.getElementById('system-status');
            statusElement.textContent = '...';
            
            setTimeout(() => {
                const status = Math.floor(Math.random() * (100 - 95) + 95);
                statusElement.textContent = status;
                showAdminNotification(`Sistem durumu: %${status}`, 'success');
            }, 1500);
        }

        function exportData() {
            showAdminNotification('Veri dışa aktarılıyor...', 'info');
            // Simulate export
            setTimeout(() => {
                showAdminNotification('Veriler başarıyla dışa aktarıldı!', 'success');
            }, 2000);
        }

        function updateChart(period) {
            const loading = document.getElementById('chart-loading');
            loading.classList.remove('hidden');
            
            setTimeout(() => {
                if (period === '1year') {
                    menuChart.data.labels = ['Oca', 'Şub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Ağu', 'Eyl', 'Eki', 'Kas', 'Ara'];
                    menuChart.data.datasets[0].data = [12, 19, 15, 25, 22, 30, 35, 28, 42, 38, 45, 52];
                } else {
                    menuChart.data.labels = ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran'];
                    menuChart.data.datasets[0].data = [@(Model.TotalMenus), 19, 15, 25, 22, 30];
                }
                menuChart.update();
                loading.classList.add('hidden');
                showAdminNotification(`Grafik ${period === '1year' ? '1 yıl' : '6 ay'} görünümünde güncellendi`, 'info');
            }, 1000);
        }

        function refreshTable() {
            const table = document.getElementById('recent-menus-table');
            showAdminNotification('Tablo yenileniyor...', 'info');
            
            setTimeout(() => {
                showAdminNotification('Tablo başarıyla yenilendi!', 'success');
                location.reload();
            }, 1000);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeChart();
            
            // Auto refresh system status every 30 seconds
            setInterval(checkSystemStatus, 30000);
        });
    </script>
}
